<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.ImageView?>

<?import org.kordamp.ikonli.javafx.FontIcon?>
<?import com.zxzinn.novelai.component.ImageControlBar?>
<BorderPane xmlns:fx="http://javafx.com/fxml"
            xmlns="http://javafx.com/javafx"
            xmlns:ikonli="http://ikonli.org/javafx"
            fx:controller="com.zxzinn.novelai.controller.generation.img2img.Img2ImgGeneratorController"
            stylesheets="@styles.css">
    <left>
        <ScrollPane fitToWidth="true" styleClass="side-panel">
            <VBox spacing="10.0" styleClass="settings-panel">
                <TitledPane text="API Settings" styleClass="settings-section">
                    <GridPane hgap="10.0" vgap="10.0">
                        <Label text="API Key" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <TextField fx:id="apiKeyField" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                        <Label text="模型" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <ComboBox fx:id="modelComboBox" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                    </GridPane>
                </TitledPane>
                <TitledPane text="Output Settings" styleClass="settings-section">
                    <GridPane hgap="10.0" vgap="10.0">
                        <Label text="寬度" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <TextField fx:id="widthField" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                        <Label text="高度" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <TextField fx:id="heightField" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                        <Label text="比例" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <TextField fx:id="ratioField" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                        <Label text="每次生成圖像數" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <TextField fx:id="countField" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                    </GridPane>
                </TitledPane>
                <TitledPane text="Sampling Settings" styleClass="settings-section">
                    <GridPane hgap="10.0" vgap="10.0">
                        <Label text="採樣器" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <ComboBox fx:id="samplerComboBox" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                        <CheckBox fx:id="smeaCheckBox" text="SMEA" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <CheckBox fx:id="smeaDynCheckBox" text="SMEA DYN" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                        <Label text="步驟" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <TextField fx:id="stepsField" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                        <Label text="種子" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <TextField fx:id="seedField" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                        <Label text="Extra Noise Seed" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                        <TextField fx:id="extraNoiseSeedField" GridPane.rowIndex="4" GridPane.columnIndex="1"/>
                        <Label text="Upload Image" GridPane.rowIndex="5" GridPane.columnIndex="0"/>
                        <Button fx:id="uploadImageButton" text="選擇圖片" onAction="#handleUploadImage"
                                GridPane.rowIndex="5" GridPane.columnIndex="1" styleClass="upload-button"/>
                    </GridPane>
                </TitledPane>
                <TitledPane text="Advanced Settings" styleClass="settings-section">
                    <GridPane hgap="10.0" vgap="10.0">
                        <CheckBox fx:id="clearLSBCheckBox" text="清除 Metadata" GridPane.rowIndex="0" GridPane.columnIndex="0" GridPane.columnSpan="2"/>
                        <Label text="水印文字" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <TextField fx:id="watermarkTextField" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                    </GridPane>
                </TitledPane>
                <HBox spacing="10.0" alignment="CENTER">
                    <Button text="生成" fx:id="generateButton" onAction="#handleGenerateOrStop" styleClass="generate-button"/>
                    <ComboBox fx:id="generateCountComboBox" promptText="生成數量"/>
                </HBox>
            </VBox>
        </ScrollPane>
    </left>
    <center>
        <VBox spacing="10.0" styleClass="main-content">
            <HBox spacing="10.0" VBox.vgrow="NEVER">
                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                    <Label text="正面提示詞:"/>
                    <TextArea fx:id="positivePromptArea" styleClass="prompt-area" VBox.vgrow="ALWAYS"/>
                </VBox>
                <VBox alignment="CENTER" spacing="5.0">
                    <Button fx:id="refreshPositivePromptButton" styleClass="refresh-button">
                        <graphic>
                            <FontIcon iconLiteral="fas-sync-alt" iconSize="16"/>
                        </graphic>
                    </Button>
                    <Button fx:id="lockPositivePromptButton" styleClass="lock-button">
                        <graphic>
                            <FontIcon fx:id="lockPositivePromptIcon" iconLiteral="fas-lock-open" iconSize="16"/>
                        </graphic>
                    </Button>
                </VBox>
                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                    <Label text="正面提示詞預覽"/>
                    <TextArea fx:id="positivePromptPreviewArea" styleClass="prompt-preview" VBox.vgrow="ALWAYS"/>
                </VBox>
            </HBox>
            <HBox spacing="10.0" VBox.vgrow="NEVER">
                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                    <Label text="負面提示詞:"/>
                    <TextArea fx:id="negativePromptArea" styleClass="prompt-area" VBox.vgrow="ALWAYS"/>
                </VBox>
                <VBox alignment="CENTER" spacing="5.0">
                    <Button fx:id="refreshNegativePromptButton" styleClass="refresh-button">
                        <graphic>
                            <FontIcon iconLiteral="fas-sync-alt" iconSize="16"/>
                        </graphic>
                    </Button>
                    <Button fx:id="lockNegativePromptButton" styleClass="lock-button">
                        <graphic>
                            <FontIcon fx:id="lockNegativePromptIcon" iconLiteral="fas-lock-open" iconSize="16"/>
                        </graphic>
                    </Button>
                </VBox>
                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                    <Label text="負面提示詞預覽"/>
                    <TextArea fx:id="negativePromptPreviewArea" styleClass="prompt-preview" VBox.vgrow="ALWAYS"/>
                </VBox>
            </HBox>
            <HBox spacing="10.0" VBox.vgrow="ALWAYS">
                <VBox spacing="5.0" HBox.hgrow="ALWAYS" prefWidth="850">
                    <StackPane fx:id="previewContainer" VBox.vgrow="ALWAYS">
                        <ScrollPane fx:id="mainScrollPane" fitToWidth="true" fitToHeight="true" styleClass="image-scroll-pane">
                            <AnchorPane>
                                <ImageView fx:id="mainImageView" AnchorPane.topAnchor="0" AnchorPane.bottomAnchor="0"
                                           AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" preserveRatio="true"/>
                            </AnchorPane>
                        </ScrollPane>
                    </StackPane>
                    <ImageControlBar fx:id="imageControlBar" />
                </VBox>

                <VBox spacing="5.0" styleClass="history-panel" prefWidth="150" HBox.hgrow="NEVER">
                    <Label text="歷史圖片"/>
                    <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" styleClass="history-scroll-pane">
                        <VBox fx:id="historyImagesContainer" spacing="5.0"/>
                    </ScrollPane>
                </VBox>
            </HBox>
        </VBox>
    </center>
</BorderPane>